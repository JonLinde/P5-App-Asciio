#!/usr/bin/env perl

use strict;
use warnings;

use App::Asciio ;

use Module::Util qw(find_installed) ;
use File::Basename ;

my $asciio = new App::Asciio() ;

my ($command_line_switch_parse_ok, $command_line_parse_message, $asciio_config)
	= $asciio->ParseSwitches([@ARGV], 0) ;

die "Error: '$command_line_parse_message'!" unless $command_line_switch_parse_ok ;

if(@{$asciio_config->{SETUP_PATHS}})
	{
	$asciio->setup($asciio_config->{SETUP_PATHS}) ;
	}
else
	{
	my ($basename, $path, $ext) = File::Basename::fileparse(find_installed('App::Asciio'), ('\..*')) ;
	$asciio->setup([$path . $basename . '/setup/setup.ini']) ;
	}

if(defined $asciio_config->{TARGETS}[0])
	{
	delete $asciio->{ACTION_VERBOSE} ;
	$asciio->run_actions_by_name(['Open', $asciio_config->{TARGETS}[0]]) ;
	}
	
$asciio->run_script($asciio_config->{SCRIPT}) ;

print $asciio->transform_elements_to_ascii_buffer() ;
